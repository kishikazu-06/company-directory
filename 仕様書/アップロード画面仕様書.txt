 8: 画面仕様_④Excelアップロード		
		
区分	項目	詳細仕様・振る舞い
画面概要	一括登録	Excelファイルを読み込み、一括で追加・更新を行う。
UI構成	ファイル選択	"・ドラッグ＆ドロップエリア または 「ファイルを選択」ボタン。
・拡張子制限：.xlsx のみ許可。
・最大サイズ制限：5MBまで。"
表示制御	初期状態	"・「ファイル選択エリア」のみを表示し、下部のサマリー、プレビューテーブル、アクションボタン群は非表示とする。
・再アップロード時：以前のプレビュー結果やエラー内容は全てクリア（リセット）してから解析を開始する。"
	遷移アニメーション	"・ファイル解析が完了したタイミングで、下部の要素（サマリー、テーブル、ボタン）を表示する。
・解析中はファイル選択エリアの下にローディング（スピナー）を表示する。"
	ファイル選択後	"・非同期通信で解析を行い、成功したら「ファイル選択エリア」の下に「プレビューテーブル」と「ボタン」を展開（SlideDown等）して表示する。
・ファイル選択エリアは残し、再アップロード（ファイルの選び直し）を可能にする。"
画面レイアウト	A. ファイル選択エリア（最上部）	"・ドラッグ＆ドロップエリア または 「ファイル選択」ボタン。
・ファイル選択直後、エリアの下にファイル名と「解析中...」のアニメーションを表示する。"
	B. 解析結果サマリー（中部）	"・解析完了後、ステータスバッジを表示する。
　例：「全 100 件（有効：80件 / エラー：20件）」
・エラーがある場合、件数を赤文字で強調する。"
	C. プレビューテーブル（メイン）	"・タブ切り替え機能を実装する。
　[すべて表示] [有効データのみ] [エラーのみ(20)]
・デフォルト挙動：エラーがある場合は「エラーのみ」タブを自動選択して表示する。
・エラー行は背景色を薄い赤にし、末尾に「エラー理由」列を表示する。
・表示制限：パフォーマンス維持のため、プレビューは最大1,000件までの表示とし、それ以上は「他 ○○件」と省略表示する（内部処理は全件行う）。
・「エラー分のみExcelダウンロード」ボタンは、このテーブルの右上に配置する（登録ボタンとは離す）。
・行に紐づかないエラーの場合はは「エラー分のみExcelダウンロード」ボタンは非表示にし、画面上でメッセージ（行に紐づかないエラー）を表示する"
	D. アクションエリア（最下部）	"・左側：「キャンセル」ボタン（一覧へ戻る）
・右側：「有効な 80 件を登録する」ボタン（Primary色）
・エラーがない場合は「全 100 件を登録する」という文言に変化する。"
処理フロー	1. 解析（Pre-validation）	"・ファイル選択時に即時バリデーションを実行。
・プレビューテーブルに結果を展開する。
・この時点ではDB保存は行わない。"
	2. 確定登録	"・「登録する」ボタン押下で、エラー行を除いた有効データのみをDBにインサートする。
・処理中は「登録中...」のローディングを表示し、二重送信を防止する。"
	3. 完了遷移	・処理成功後、自動的に**名簿一覧画面（ダッシュボード）**へ遷移する。
	4. 登録キャンセル	・「キャンセル」ボタン押下で、選択中のファイルやプレビュー内容を破棄し、名簿一覧画面へ遷移する。
完了後の動作	結果通知モーダル	"・一覧画面遷移直後に、以下のモーダルを自動表示する。
　タイトル：「インポート完了」
　本文：「処理が完了しました。
　更新：〇件
　新規登録：〇件
　警告：〇件
　エラー：〇件」
　ボタン（エラー時のみ）：「エラーをダウンロード」
　ボタン（警告時のみ）：「警告をダウンロード」
　ボタン（共通）：「閉じる」"
例外ケース	全件エラーの場合	"・「登録する」ボタンを非活性（押せない状態）にする。
・「エラー内容を確認し、修正してから再アップロードしてください」というメッセージを表示する。"
エラーファイル仕様	ファイル構成	"・元のアップロードファイルと同じ列構成（企業ID、企業名…）を維持する。
・末尾に「エラー内容」という列を自動追加し、具体的なエラー理由（例：「郵便番号の桁数が不足しています」）を記載する。"
	再利用性	"・ユーザーがこのファイルを修正し、そのまま再アップロード用ファイルとして使えるようにする。
・再アップロード時は「エラー内容」列があっても無視して取り込む仕様とする。"
インポート仕様	列・ヘッダー規則	"・インポート用Excelの1行目は列名（ヘッダー）とする。
・Excel側の列順は自由とするが、列名は以下の固定名称を使用：
「企業ID」「企業名」「住所」「郵便番号」「登録日」「備考」
・アプリ内部での固定順「企業ID → 企業名 → 住所 → 郵便番号 → 登録日 → 備考」
・読み取り時は列名をキーにアプリ側の固定順へマッピングして登録する。"
	更新ルール	"・企業IDが空欄もしくは企業ID列がない ⇒ 「新規登録」（Auto Increment）
・企業ID入力あり ⇒ DBに存在すれば「上書き更新」、存在しなければ「エラー（更新対象なし」とする。"
	バリデーション	"・名簿追加・編集画面と同じ入力規則を適用（必須、文字数、型）。
・重複チェック：システム要件による（例：同名企業の登録を警告するなど）。"
エラーメッセージ	行に紐づくエラー	"・必須項目の空欄
「必須項目が空欄です：企業名を入力してください。」
・型不一致（文字型／数値型／日付型）
「データ形式が不正です：日付として認識できません。」
「データ形式が不正です：数値が必要です。」
・郵便番号フォーマット違反
「郵便番号の形式が不正です（例：123-4567）。」
・企業IDの不正（文字列、桁数異常など）
「企業IDが正しい形式ではありません（半角数字のみ、桁数指定あり）。」
・企業IDはあるが存在しない（更新対象なし）
「企業IDが未登録のため更新できません。」
・長さオーバー（備考など）
「項目の文字数が上限を超えています。」
・Excel内でIDが重複している
「同一ファイル内で企業IDが重複しています。」
・更新ルール違反（衝突など）
「既存データと衝突しているため更新できません。」"
	行に紐づかないエラー.1	"・Excelファイル破損・ZIP構造エラー
「ファイルを読み込めません。Excelファイルが壊れている可能性があります。」
・拡張子と中身の不一致
「ファイル形式が不正です。正しいExcel形式（.xlsx）をアップロードしてください。」
・想定シートが存在しない（Sheet1なし）
「指定のシートが見つかりません。正しいテンプレートを使用してください。」
・書式崩れ（列結合などで読み取れない）
「セルの構造が崩れているため、データを読み取れません。セル結合等を解除して再保存してください。」
・列名が不一致（足りない／余計／誤字）
「列名が正しくありません。テンプレートの列名と一致しているか確認してください。」"
	行に紐づかないエラー.2	"・文字コード問題（Shift_JIS等）
「文字コードが読み取れません。Excel形式（.xlsx）で保存し直してください。」
・区切り文字違い（CSVでタブ区切りなど）
「データ形式が不正です。正しいExcel形式または対応したCSV形式でアップロードしてください。」
・シートが空
「シートにデータがありません。」
・ヘッダー行の欠落
「1行目に列名（ヘッダー）がありません。テンプレートを利用して作成してください。」
・日付セル形式の破損
「日付セルが破損しているため読み取れません。対象セルを再入力して保存してください。」
・行数が多すぎて読み込めない（メモリ）
「データ量が大きすぎるため読み込めません。ファイルを分割して再アップロードしてください。」"
